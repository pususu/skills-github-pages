{{ define "main" }}
<div class="three-column-layout">
    <!-- 左侧：文件目录 -->
    <aside class="sidebar-left">
        <div class="file-tree">
            <h3>文章目录</h3>
            {{ $pages := where site.RegularPages "Type" "posts" }}
            <ul class="tree">
                {{ range $pages.GroupByDate "2006" }}
                <li class="year-group">
                    <span class="year">{{ .Key }}</span>
                    <ul>
                        {{ range .Pages }}
                        <li>
                            <a href="{{ .Permalink }}" {{ if eq .Page . }}class="active"{{ end }}>
                                {{ .Title }}
                            </a>
                        </li>
                        {{ end }}
                    </ul>
                </li>
                {{ end }}
            </ul>
        </div>
    </aside>

    <!-- 中间：文章正文 -->
    <main class="content">
        <article class="post">
            <header class="post-header">
                <h1 class="post-title">{{ .Title }}</h1>
                <div class="post-meta">
                    <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006年1月2日" }}</time>
                    {{ with .Params.categories }}
                    <span class="categories"> |
                        {{ range $i, $cat := . }}
                            {{ if $i }} / {{ end }}{{ $cat }}
                        {{ end }}
                    </span>
                    {{ end }}
                </div>
            </header>

            <div class="post-content">
                {{ .Content }}
            </div>

            {{ with .Params.tags }}
            <div class="post-tags">
                {{ range . }}
                <span class="tag">{{ . }}</span>
                {{ end }}
            </div>
            {{ end }}
        </article>
    </main>

    <!-- 右侧：文章大纲 -->
    <aside class="sidebar-right">
        <div class="table-of-contents">
            <h3>文章大纲</h3>
            <nav id="toc">
                {{ .TableOfContents }}
            </nav>
        </div>

        {{ if .Site.Params.categories }}
        <div class="categories">
            <h3>分类</h3>
            <ul>
                {{ range $key, $taxonomy := .Site.Taxonomies.categories }}
                <li>
                    <a href="{{ "/categories/" | relURL }}{{ $key | urlize }}">{{ $key }}</a>
                    <span class="count">({{ $taxonomy.Count }})</span>
                </li>
                {{ end }}
            </ul>
        </div>
        {{ end }}
    </aside>
</div>
{{ end }}
